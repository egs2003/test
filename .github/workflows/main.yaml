name: ErhÃ¶he Versionsnummer unter Windows

on: 
  #push:  # Wird bei jedem Push ausgelÃ¶st
  workflow_dispatch:
  schedule:
    - cron: '*/1 * * * *'
permissions: 
  contents: write  # GitHub Actions darf ins Repo schreiben
jobs:
  test:
    runs-on: self-hosted #windows-latest
    steps:
      - name: test
        run: write-host 'Hallo'
  bump-version:
    runs-on: self-hosted #windows-latest
    steps:
      - name: Repository auschecken
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Stellt sicher, dass der vollstÃ¤ndige Git-Verlauf verfÃ¼gbar ist

      - name: Version erhÃ¶hen
        shell: pwsh  # PowerShell als Shell nutzen
        run: |
          # Datei einlesen
          $old_version = Get-Content version.txt

          # Versionsnummer erhÃ¶hen (letzte Stelle)
          $parts = $old_version -split '\.'
          $parts[-1] = [int]$parts[-1] + 1
          $new_version = $parts -join "."

          Write-Output "ErhÃ¶he Version: $old_version -> $new_version"

          # Neue Version zurÃ¼ck in die Datei schreiben
          Set-Content -Path version.txt -Value $new_version
          set-content -Path test.txt -Value (whoami /groups)

          set-content -Path 'C:\Users\Marcel\AppData\Local\Temp\test123.txt' -Value 'Hallo Welt'

      - name: Ã„nderungen committen und pushen
      
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

          git add version.txt
          git add test.txt
          git commit -m "ðŸ”¼ Version erhÃ¶ht: $(Get-Content version.txt)"
          git push
